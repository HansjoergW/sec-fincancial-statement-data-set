<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>secfsdstools.f_standardize.is_standardize API documentation</title>
<meta name="description" content="Contains the definitions to standardize incaome statements." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>secfsdstools.f_standardize.is_standardize</code></h1>
</header>
<section id="section-intro">
<p>Contains the definitions to standardize incaome statements.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Contains the definitions to standardize incaome statements.&#34;&#34;&#34;
from typing import List, Set

import pandas as pd
import pandera as pa

from secfsdstools.f_standardize.base_prepivot_rules import PrePivotDeduplicate, PrePivotCorrectSign
from secfsdstools.f_standardize.base_rule_framework import RuleGroup, Rule
from secfsdstools.f_standardize.base_rules import CopyTagRule, SumUpRule, SubtractFromRule, \
    missingsumparts_rules_creator, MissingSummandRule, PostSetToZero
from secfsdstools.f_standardize.base_validation_rules import ValidationRule, SumValidationRule
from secfsdstools.f_standardize.standardizing import Standardizer

top_100_operating_costs = [
    &#39;SellingGeneralAndAdministrativeExpense&#39;,
    &#39;GeneralAndAdministrativeExpense&#39;,
    &#39;ResearchAndDevelopmentExpense&#39;,
    &#39;SellingAndMarketingExpense&#39;,
    &#39;AmortizationOfIntangibleAssets&#39;,
    &#39;DepreciationAndAmortization&#39;,
    &#39;RestructuringCharges&#39;,
    &#39;ProfessionalFees&#39;,
    &#39;SellingExpense&#39;,
    &#39;AssetImpairmentCharges&#39;,
    &#39;OtherOperatingIncomeExpenseNet&#39;,
    &#39;DepreciationDepletionAndAmortization&#39;,
    &#39;LaborAndRelatedExpense&#39;,
    &#39;BusinessCombinationAcquisitionRelatedCosts&#39;,
    &#39;GoodwillImpairmentLoss&#39;,
    &#39;Depreciation&#39;,
    &#39;OtherCostAndExpenseOperating&#39;,
    &#39;MarketingAndAdvertisingExpense&#39;,
    &#39;RestructuringSettlementAndImpairmentProvisions&#39;,
    &#39;SalariesAndWages&#39;,
    &#39;ShareBasedCompensation&#39;,
    &#39;ProvisionForDoubtfulAccounts&#39;,
    &#39;GainLossOnDispositionOfAssets&#39;,
    &#39;CostsAndExpenses&#39;,
    &#39;OperatingCostsAndExpenses&#39;,
    &#39;OtherGeneralAndAdministrativeExpense&#39;,
    &#39;ResearchAndDevelopmentExpenseExcludingAcquiredInProcessCost&#39;,
    &#39;GainLossOnSaleOfPropertyPlantEquipment&#39;,
    &#39;GoodwillAndIntangibleAssetImpairment&#39;,
    &#39;MarketingExpense&#39;,
    &#39;GainLossOnDispositionOfAssets1&#39;,
    &#39;AdvertisingExpense&#39;,
    &#39;BusinessCombinationContingentConsiderationArrangementsChangeInAmountOfContingentConsiderationLiability1&#39;,
    &#39;LeaseAndRentalExpense&#39;,
    &#39;LegalFees&#39;,
    &#39;OtherSellingGeneralAndAdministrativeExpense&#39;,
    &#39;GainLossRelatedToLitigationSettlement&#39;,
    &#39;IncomeLossFromEquityMethodInvestments&#39;,
    &#39;DepreciationNonproduction&#39;,
    &#39;AllocatedShareBasedCompensationExpense&#39;,
    &#39;SalariesWagesAndOfficersCompensation&#39;,
    &#39;TravelAndEntertainmentExpense&#39;,
    &#39;ImpairmentOfLongLivedAssetsHeldForUse&#39;,
    &#39;ResearchAndDevelopmentExpenseSoftwareExcludingAcquiredInProcessCost&#39;,
    &#39;OfficersCompensation&#39;,
    &#39;OtherGeneralExpense&#39;,
    &#39;ImpairmentOfIntangibleAssetsExcludingGoodwill&#39;,
    &#39;OtherOperatingIncome&#39;,
    &#39;ProfessionalAndContractServicesExpense&#39;,
    &#39;LitigationSettlementExpense&#39;,
    &#39;GainLossOnSaleOfBusiness&#39;,
    &#39;ImpairmentOfIntangibleAssetsFinitelived&#39;,
    &#39;RestructuringCostsAndAssetImpairmentCharges&#39;,
    &#39;ForeignCurrencyTransactionGainLossBeforeTax&#39;,
    &#39;OtherDepreciationAndAmortization&#39;,
    &#39;OtherExpenses&#39;,
    &#39;RestructuringCosts&#39;,
    &#39;SalesCommissionsAndFees&#39;,
    &#39;BusinessCombinationIntegrationRelatedCosts&#39;,
    &#39;AdjustmentForAmortization&#39;,
    &#39;InterestExpense&#39;,
    &#39;ImpairmentOfIntangibleAssetsIndefinitelivedExcludingGoodwill&#39;,
    &#39;CommunicationsAndInformationTechnology&#39;,
    &#39;PreOpeningCosts&#39;,
    &#39;OtherNonrecurringIncomeExpense&#39;,
    &#39;GainLossOnSalesOfAssetsAndAssetImpairmentCharges&#39;,
    &#39;OtherAssetImpairmentCharges&#39;,
    &#39;ImpairmentOfLongLivedAssetsToBeDisposedOf&#39;,
    &#39;DisposalGroupNotDiscontinuedOperationGainLossOnDisposal&#39;,
    &#39;GainLossOnSaleOfOtherAssets&#39;,
    &#39;ShippingHandlingAndTransportationCosts&#39;,
    &#39;RoyaltyExpense&#39;,
    &#39;GeneralInsuranceExpense&#39;,
    &#39;ManagementFeeExpense&#39;,
    &#39;GainsLossesOnSalesOfAssets&#39;,
    &#39;OccupancyNet&#39;,
    &#39;TaxesExcludingIncomeAndExciseTaxes&#39;,
    &#39;TechnologyServicesCosts&#39;,
    &#39;OtherIncome&#39;,
    &#39;RestructuringAndRelatedCostIncurredCost&#39;,
    &#39;OtherLaborRelatedExpenses&#39;,
    &#39;SeveranceCosts1&#39;,
    &#39;UtilitiesOperatingExpenseMaintenanceAndOperations&#39;,
    &#39;EmployeeBenefitsAndShareBasedCompensation&#39;,
    &#39;BusinessDevelopment&#39;,
    &#39;CostsAndExpensesRelatedParty&#39;,
    &#39;ExplorationExpenseMining&#39;,
    &#39;DepreciationAmortizationAndAccretionNet&#39;,
    &#39;GainLossOnDispositionOfProperty&#39;,
    &#39;InventoryWriteDown&#39;,
    &#39;AssetRetirementObligationAccretionExpense&#39;,
    &#39;InsuranceRecoveries&#39;,
    &#39;AmortizationOfAcquiredIntangibleAssets&#39;,
    &#39;GainsLossesOnExtinguishmentOfDebt&#39;,
    &#39;AmortizationOfAcquisitionCosts&#39;,
    &#39;TangibleAssetImpairmentCharges&#39;,
    &#39;ResearchAndDevelopmentInProcess&#39;,
    &#39;OperatingLeasesRentExpenseNet&#39;,
    &#39;OperatingLeaseExpense&#39;,
]


class PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit(Rule):
    &#34;&#34;&#34;
    Usually, when TaxExpenseBenefit is a positive number, meaning that this amount
    of taxes were paid by the company. Therefore, the equation

    IncomeLossBeforeTaxes - TaxExpenseBenefit = NetIncomeLoss

    However, there  is a quite significant number of reports, which us a negative
    number to display paid Taxes and therefore, the following equations would be
    used:

    IncomeLossBeforeTaxes + TaxExpenseBenefit = NetIncomeLoss

    This rule select these entries and tries to fix that, whenever possible.

    Since the rules calculate IncomeLossFromContinuingOperations as follows

    IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit
    - IncomeTaxExpenseBenefit
    = IncomeLossFromContinuingOperations

    We might end up having a wrong value for IncomeLossFromContinuingOperation.

    Therefore, we mask the entries, where

    abs(NetIncomeLoss - IncomeLossFromContinuingOperations) = 2*abs(IncomeTaxExpenseBenefit)
    if IncomeTaxExpenseBenefit &gt; 0

    in order to fix the sign for IncomeTaxExpenseBenefit and to correct
    IncomeLossFromContinuingOperations

    The rule also uses some threshold.

    Of course, this is not perfect and does not consider the cases with DiscontinuedOperations,
    However, it is able to fix a significant number of cases.

    For the masked entries, it changes the sign of TaxExpenseBenefit
    and recalculates IncomeLossFromContinuingOperations

    &#34;&#34;&#34;

    def get_target_tags(self) -&gt; List[str]:
        &#34;&#34;&#34;
        returns a list of tags that could be affected/changed by this rule

        Returns:
            List[str]: list with affected tags/columns
        &#34;&#34;&#34;
        return [&#39;IncomeLossFromContinuingOperations&#39;, &#39;AllIncomeTaxExpenseBenefit&#39;]

    def get_input_tags(self) -&gt; Set[str]:
        &#34;&#34;&#34;
        return all tags that the rules within this group need.

        Returns:
            Set[str]: set of all input tags that are used by rules in this group
        &#34;&#34;&#34;
        return {&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                &#39;AllIncomeTaxExpenseBenefit&#39;, &#39;IncomeLossFromContinuingOperations&#39;, &#39;ProfitLoss&#39;}

    def mask(self, data_df: pd.DataFrame) -&gt; pa.typing.Series[bool]:
        &#34;&#34;&#34;
            returns a Series[bool] which defines the rows to which this rule has to be applied.

        Args:
            data_df dataframe on which the rules should be applied

        Returns:
            pa.typing.Series[bool]: a boolean Series that marks which rows have to be calculated
        &#34;&#34;&#34;
        return (data_df.AllIncomeTaxExpenseBenefit != 0) &amp; \
            ((data_df.ProfitLoss - data_df.IncomeLossFromContinuingOperations).abs() &gt;=
             1.8 * data_df.AllIncomeTaxExpenseBenefit.abs())

    def apply(self, data_df: pd.DataFrame, mask: pa.typing.Series[bool]):
        &#34;&#34;&#34;
        apply the rule on the provided dataframe. the rows, on which the rule has to be applied
        is defined by the provide mask Series.

        Important, the rules have to be applied &#34;in-place&#34;, so no new dataframe is produced.

        Args:
            df: dataframe on which the rule has to be applied
            mask: a Series marking the rows in the dataframe on which the rule has to be applied
        &#34;&#34;&#34;

        data_df.loc[mask, &#39;AllIncomeTaxExpenseBenefit&#39;] = -data_df.AllIncomeTaxExpenseBenefit

        # recalculate IncomeLossFromContinuingOperations
        data_df.loc[mask, &#39;IncomeLossFromContinuingOperations&#39;] = \
            data_df[&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;]
        subtract_mask = mask &amp; ~data_df.AllIncomeTaxExpenseBenefit.isna()
        data_df.loc[subtract_mask, &#39;IncomeLossFromContinuingOperations&#39;] = (
                data_df[&#39;IncomeLossFromContinuingOperations&#39;] -
                data_df.AllIncomeTaxExpenseBenefit)

    def get_description(self) -&gt; str:
        return &#34;Corrects the sign of &#39;IncomeTaxExpenseBenefits&#39; if it seems to be wrong. Checks&#34; \
               &#34;if the difference between &#39;NetIncomeLoss&#39; and &#39;IncomeLossFromContinuingOperations&#39;&#34; \
               &#34;is about 2. Which is a clear indication, that the sign was wrong.&#34;


class PostFixSign(Rule):
    &#34;&#34;&#34;
    Fixes the sign of an Addition, if the Summand has the wrong sign.

    For instance, the following equation should be true:
    ProfitLoss + AllIncomeTaxExpenseBenefit = IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit

    However, there are cases when
    ProfitLoss - AllIncomeTaxExpenseBenefit = IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit

    is true, so obviously AllIncomTaxExpenseBenefit has the wrong sign.

    &#34;&#34;&#34;

    def __init__(self, start_tag: str, summand_tag: str, result_tag: str):
        self.start_tag = start_tag
        self.summand_tag = summand_tag
        self.result_tag = result_tag

    def get_target_tags(self) -&gt; List[str]:
        &#34;&#34;&#34;
        returns a list of tags that could be affected/changed by this rule

        Returns:
            List[str]: list with affected tags/columns
        &#34;&#34;&#34;
        return [self.summand_tag]

    def get_input_tags(self) -&gt; Set[str]:
        &#34;&#34;&#34;
        return all tags that the rules within this group need.

        Returns:
            Set[str]: set of all input tags that are used by rules in this group
        &#34;&#34;&#34;
        return {self.start_tag, self.summand_tag, self.result_tag}

    def mask(self, data_df: pd.DataFrame) -&gt; pa.typing.Series[bool]:
        &#34;&#34;&#34;
            returns a Series[bool] which defines the rows to which this rule has to be applied.

        Args:
            data_df dataframe on which the rules should be applied

        Returns:
            pa.typing.Series[bool]: a boolean Series that marks which rows have to be calculated
        &#34;&#34;&#34;
        return (data_df[self.summand_tag] != 0) &amp; \
            ((data_df[self.start_tag] - data_df[self.summand_tag]) == data_df[self.result_tag])

    def apply(self, data_df: pd.DataFrame, mask: pa.typing.Series[bool]):
        &#34;&#34;&#34;
        apply the rule on the provided dataframe. the rows, on which the rule has to be applied
        is defined by the provide mask Series.

        Important, the rules have to be applied &#34;in-place&#34;, so no new dataframe is produced.

        Args:
            df: dataframe on which the rule has to be applied
            mask: a Series marking the rows in the dataframe on which the rule has to be applied
        &#34;&#34;&#34;
        # simply invert the sign
        data_df.loc[mask, self.summand_tag] = -data_df[self.summand_tag]

    def get_description(self) -&gt; str:
        return f&#34;Corrects the sign of &#39;{self.summand_tag}&#39; if it seems to be wrong.&#34; \
               f&#34;Checks if &#39;{self.start_tag} - {self.summand_tag} = {self.result_tag}&#39;.&#34; \
               f&#34; If that equation holds true, the sign of &#39;{self.summand_tag}&#39; is inversed, &#34; \
               f&#34; so that &#39;{self.start_tag} - {self.summand_tag} = {self.result_tag}&#39; becomes true&#34;


class IncomeStatementStandardizer(Standardizer):
    &#34;&#34;&#34;
    The goal of this Standardizer is to create IncomeStatements that are comparable,
    meaning that they have the same tags.

    At the end, the standardized IS contains the following columns

    Position    Relation

    Revenues
           + SalesRevenueGoodsNet
           + SalesRevenueServicesNet
           + OtherSalesRevenueNet
           --------------
        or SalesRevenueNet

        or RevenuesSum
              RevenueFromContractWithCustomerExcludingAssessedTax
              RevenueFromContractWithCustomerIncludingAssessedTax
              RevenuesExcludingInterestAndDividends
              RegulatedAndUnregulatedOperatingRevenue
              ...

        or InterestAndDividendIncomeOperating
        --------
        Revenues
        ========

    CostOfRevenue
          &#39;CostOfGoodsSold&#39;,
        + &#39;CostOfServices&#39;
        ---------------
          &#39;CostOfGoodsAndServicesSold&#39;,
        + &#39;LicenseCost&#39;,
        ----------------
          &#39;CostOfRevenue&#39;,
        ================


    Gross Profit                        Revenues - Cost of Goods and Services Sold
    Operating Expenses

    Operating Income (Loss)             Gross Profit - Operating Expenses
    Other Income and Expenses

    Income Before Tax               Operating Income + Other Income and Expenses
    Income Tax Expense (Benefit)

    Net Income (Loss)               Income Before Tax - Income Tax Expense
    &#34;&#34;&#34;
    prepivot_rule_tree = RuleGroup(
        prefix=&#34;IS_PREPIV&#34;,
        rules=[PrePivotDeduplicate(),
               PrePivotCorrectSign(
                   # all these tags are costOf and therefore should appear as positive
                   tag_list=[&#39;CostOfGoodsSold&#39;,
                             &#39;CostOfServices&#39;,
                             &#39;CostOfGoodsAndServicesSold&#39;,
                             &#39;CostOfRevenue&#39;,
                             &#39;CostOfGoodsSoldExcludingDepreciationDepletionAndAmortization&#39;,
                             &#39;CostOfGoodsSoldDepreciationDepletionAndAmortization&#39;,
                             &#39;CostOfGoodsSoldDepletion&#39;,
                             &#39;CostOfGoodsSoldDepreciation&#39;,
                             &#39;CostOfGoodsSoldAmortization&#39;,
                             &#39;CostOfGoodsSoldDepreciationAndAmortization&#39;,
                             &#39;CostOfGoodsSoldDirectFinancingLease&#39;,
                             &#39;CostOfGoodsSoldElectric&#39;,
                             &#39;CostOfGoodsSoldDirectMaterials&#39;,
                             &#39;CostOfGoodsSoldDirectLabor&#39;,
                             &#39;CostOfGoodsSoldOverhead&#39;,
                             &#39;CostOfGoodsSoldOilAndGas&#39;,
                             &#39;CostOfGoodsSoldSubscription&#39;,
                             &#39;CostOfGoodsSoldDirectTaxesAndLicensesCosts&#39;,
                             &#39;CostOfGoodsSoldMaintenanceCosts&#39;,
                             &#39;CostOfGoodsSoldSalesTypeLease&#39;,
                             &#39;CostOfServicesExcludingDepreciationDepletionAndAmortization&#39;,
                             &#39;CostOfServicesDepreciation&#39;,
                             &#39;CostOfServicesDepreciationAndAmortization&#39;,
                             &#39;CostOfServicesCatering&#39;,
                             &#39;CostOfServicesAmortization&#39;,
                             &#39;CostOfServicesOilAndGas&#39;,
                             &#39;CostOfServicesDirectTaxesAndLicensesCosts&#39;,
                             &#39;CostOfServicesMaintenanceCosts&#39;,
                             &#39;CostOfServicesLicensesAndServices&#39;,
                             &#39;CostOfServicesDirectLabor&#39;,
                             &#39;CostOfServicesLicensesAndMaintenanceAgreements&#39;,
                             &#39;CostOfServicesEnergyServices&#39;,
                             &#39;CostOfServicesDirectMaterials&#39;,
                             &#39;CostOfServicesEnvironmentalRemediation&#39;,
                             &#39;CostOfServicesOverhead&#39;,
                             &#39;CostOfGoodsAndServicesSoldDepreciationAndAmortization&#39;,
                             &#39;CostOfGoodsAndServicesSoldAmortization&#39;,
                             &#39;CostOfGoodsAndServicesSoldOverhead&#39;,
                             &#39;CostOfGoodsAndServicesSoldDepreciation&#39;,
                             &#39;CostOfGoodsAndServicesEnergyCommoditiesAndServices&#39;,
                             &#39;CostOfGoodsAndServiceExcludingDepreciationDepletionAndAmortization&#39;
                             ],
                   is_positive=True
               )]
    )

    is_revenue_rg = RuleGroup(
        prefix=&#34;Rev&#34;,
        rules=[
            # normally, (Goods and Services) Gross and Net appear together, resp. Net has priority.
            # so if net is not present, we copy the gross value in the net value
            # and then sum the nets up to the SalesRevenue
            CopyTagRule(
                original=&#39;SalesRevenueGoodsGross&#39;,
                target=&#39;SalesRevenueGoodsNet&#39;),

            CopyTagRule(
                original=&#39;SalesRevenueServicesGross&#39;,
                target=&#39;SalesRevenueServicesNet&#39;),

            SumUpRule(sum_tag=&#39;SalesRevenueNet&#39;,
                      potential_summands=[
                          &#39;SalesRevenueGoodsNet&#39;,
                          &#39;SalesRevenueServicesNet&#39;],
                      optional_summands=[
                          &#39;OtherSalesRevenueNet&#39;
                      ]),
            # if the Revenues is not set, we copy SalesRevenuesNet into Revenues
            CopyTagRule(original=&#39;SalesRevenueNet&#39;, target=&#39;Revenues&#39;),

            # RevenueFromContractWithCustomer-tags are also often used to report the
            # total Revenue. so the following rules take care of these cases.
            # the order of the rules also defines the precedence.
            # first: if RevenueFromContractWithCustomerExcludingAssessedTax is not set
            #    we calculate it from RevenueFromContractWithCustomerIncludingAssessedTax
            #          and ExciseAndSalesTaxes (if present)
            SubtractFromRule(
                subtract_from_tag=&#39;RevenueFromContractWithCustomerIncludingAssessedTax&#39;,
                potential_subtract_tags=[&#39;ExciseAndSalesTaxes&#39;],
                target_tag=&#39;RevenueFromContractWithCustomerExcludingAssessedTax&#39;),

            # second Excluding has the higher precedence than Including
            CopyTagRule(original=&#39;RevenueFromContractWithCustomerExcludingAssessedTax&#39;,
                        target=&#39;Revenues&#39;),
            CopyTagRule(original=&#39;RevenueFromContractWithCustomerIncludingAssessedTax&#39;,
                        target=&#39;Revenues&#39;),

            # if Revenues couldn&#39;t be defined so far, RevenuesExcludingInterestAndDividends
            # is also a tag that is commonly used to define the total Revenue
            CopyTagRule(original=&#39;RevenuesExcludingInterestAndDividends&#39;,
                        target=&#39;Revenues&#39;),

            # if we were not able to define the Revenue so far, there are
            # a couple of other tags which define Revenue, so we count them together
            # and set the total as Revenue
            SumUpRule(sum_tag=&#39;RevenuesSum&#39;,
                      potential_summands=[
                          &#39;RegulatedAndUnregulatedOperatingRevenue&#39;,
                          &#39;HealthCareOrganizationPatientServiceRevenue&#39;,
                          &#39;ContractsRevenue&#39;,
                          &#39;RevenueOilAndGasServices&#39;,
                          &#39;HealthCareOrganizationRevenue&#39;,
                          &#39;RevenueMineralSales&#39;,
                          &#39;SalesRevenueEnergyServices&#39;,
                          &#39;RealEstateRevenueNet&#39;,
                          &#39;OperatingLeasesIncomeStatementLeaseRevenue&#39;,
                          &#39;LicensesRevenue&#39;, &#39;RevenueFromRelatedParties&#39;,
                          &#39;BrokerageCommissionsRevenue&#39;, &#39;RoyaltyRevenue&#39;, &#39;OilAndGasSalesRevenue&#39;,
                          &#39;OilAndGasRevenue&#39;, &#39;OtherRealEstateRevenue&#39;,
                          &#39;TechnologyServicesRevenue&#39;, &#39;ManagementFeesRevenue&#39;,
                          &#39;ReimbursementRevenue&#39;,
                          &#39;OperatingLeasesIncomeStatementMinimumLeaseRevenue&#39;,
                          &#39;FoodAndBeverageRevenue&#39;, &#39;MaintenanceRevenue&#39;,
                          &#39;LicenseAndServicesRevenue&#39;, &#39;FranchiseRevenue&#39;, &#39;SubscriptionRevenue&#39;,
                          &#39;FinancialServicesRevenue&#39;,
                          &#39;RevenueFromGrants&#39;,
                          &#39;GasGatheringTransportationMarketingAndProcessingRevenue&#39;,
                          &#39;OccupancyRevenue&#39;, &#39;NaturalGasProductionRevenue&#39;,
                          &#39;SalesRevenueServicesGross&#39;, &#39;InvestmentBankingRevenue&#39;,
                          &#39;AdvertisingRevenue&#39;, &#39;RevenueOtherFinancialServices&#39;,
                          &#39;OilAndCondensateRevenue&#39;, &#39;RevenueFromLeasedAndOwnedHotels&#39;,
                          &#39;RevenuesNetOfInterestExpense&#39;, &#39;RegulatedAndUnregulatedOperatingRevenue&#39;,
                          &#39;UnregulatedOperatingRevenue&#39;, &#39;ElectricUtilityRevenue&#39;,
                          &#39;CargoAndFreightRevenue&#39;, &#39;OtherHotelOperatingRevenue&#39;,
                          &#39;CasinoRevenue&#39;, &#39;RefiningAndMarketingRevenue&#39;,
                          &#39;PrincipalTransactionsRevenue&#39;, &#39;InterestRevenueExpenseNet&#39;,
                          &#39;HomeBuildingRevenue&#39;, &#39;OtherRevenueExpenseFromRealEstateOperations&#39;,
                          &#39;GasDomesticRegulatedRevenue&#39;, &#39;LicenseAndMaintenanceRevenue&#39;,
                          &#39;RegulatedOperatingRevenue&#39;, &#39;AdmissionsRevenue&#39;, &#39;PassengerRevenue&#39;
                      ],
                      optional_summands=[
                          &#39;OtherSalesRevenueNet&#39;
                      ]),

            CopyTagRule(original=&#39;RevenuesSum&#39;, target=&#39;Revenues&#39;),
            # if there is nothing else
            CopyTagRule(original=&#39;InvestmentIncomeInterest&#39;, target=&#39;Revenues&#39;)
        ]
    )

    is_costofrevenue_rg = RuleGroup(
        prefix=&#34;costrevenue&#34;,
        rules=[
            SumUpRule(sum_tag=&#39;CostOfGoodsSold&#39;,
                      potential_summands=[
                          &#39;CostOfGoodsSoldExcludingDepreciationDepletionAndAmortization&#39;,
                          &#39;CostOfGoodsSoldDepreciationDepletionAndAmortization&#39;,
                          &#39;CostOfGoodsSoldDepletion&#39;,
                          &#39;CostOfGoodsSoldDepreciation&#39;,
                          &#39;CostOfGoodsSoldAmortization&#39;,
                          &#39;CostOfGoodsSoldDepreciationAndAmortization&#39;,
                          &#39;CostOfGoodsSoldDirectFinancingLease&#39;,
                          &#39;CostOfGoodsSoldElectric&#39;,
                          &#39;CostOfGoodsSoldDirectMaterials&#39;,
                          &#39;CostOfGoodsSoldDirectLabor&#39;,
                          &#39;CostOfGoodsSoldOverhead&#39;,
                          &#39;CostOfGoodsSoldOilAndGas&#39;,
                          &#39;CostOfGoodsSoldSubscription&#39;,
                          &#39;CostOfGoodsSoldDirectTaxesAndLicensesCosts&#39;,
                          &#39;CostOfGoodsSoldMaintenanceCosts&#39;,
                          &#39;CostOfGoodsSoldSalesTypeLease&#39;]),

            SumUpRule(sum_tag=&#39;CostOfServices&#39;,
                      potential_summands=[
                          &#39;CostOfServicesExcludingDepreciationDepletionAndAmortization&#39;,
                          &#39;CostOfServicesDepreciation&#39;,
                          &#39;CostOfServicesDepreciationAndAmortization&#39;,
                          &#39;CostOfServicesCatering&#39;,
                          &#39;CostOfServicesAmortization&#39;,
                          &#39;CostOfServicesOilAndGas&#39;,
                          &#39;CostOfServicesDirectTaxesAndLicensesCosts&#39;,
                          &#39;CostOfServicesMaintenanceCosts&#39;,
                          &#39;CostOfServicesLicensesAndServices&#39;,
                          &#39;CostOfServicesDirectLabor&#39;,
                          &#39;CostOfServicesLicensesAndMaintenanceAgreements&#39;,
                          &#39;CostOfServicesEnergyServices&#39;,
                          &#39;CostOfServicesDirectMaterials&#39;,
                          &#39;CostOfServicesEnvironmentalRemediation&#39;,
                          &#39;CostOfServicesOverhead&#39;
                      ]),

            SumUpRule(sum_tag=&#39;CostOfGoodsAndServicesSold&#39;,
                      potential_summands=[
                          &#39;CostOfGoodsSold&#39;,
                          &#39;CostOfServices&#39;]),

            SumUpRule(sum_tag=&#39;CostOfGoodsAndServicesSold&#39;,
                      potential_summands=[
                          &#39;CostOfGoodsAndServicesSoldDepreciationAndAmortization&#39;,
                          &#39;CostOfGoodsAndServicesSoldAmortization&#39;,
                          &#39;CostOfGoodsAndServicesSoldOverhead&#39;,
                          &#39;CostOfGoodsAndServicesSoldDepreciation&#39;,
                          &#39;CostOfGoodsAndServicesEnergyCommoditiesAndServices&#39;,
                          &#39;CostOfGoodsAndServiceExcludingDepreciationDepletionAndAmortization&#39;]
                      ),
            CopyTagRule(original=&#39;CostOfGoodsAndServicesSold&#39;, target=&#39;CostOfRevenue&#39;),
        ]
    )

    # GrossProfit is the only tag used to indicate GrossProfit

    is_missing_rev_cost_gross = RuleGroup(
        prefix=&#34;RevCostGross&#34;,
        rules=missingsumparts_rules_creator(sum_tag=&#39;Revenues&#39;,
                                            summand_tags=[&#39;CostOfRevenue&#39;, &#39;GrossProfit&#39;])
    )

    is_grossProfit = RuleGroup(
        prefix=&#39;grossprofit&#39;,
        rules=[
            # for investment companies
            CopyTagRule(original=&#39;GrossInvestmentIncomeOperating&#39;, target=&#39;GrossProfit&#39;),
            CopyTagRule(original=&#39;InterestAndDividendIncomeOperating&#39;, target=&#39;GrossProfit&#39;)
        ]
    )

    is_operating = RuleGroup(
        prefix=&#34;operating&#34;,
        rules=[
            SumUpRule(sum_tag=&#39;OperatingExpensesSum&#39;,
                      potential_summands=top_100_operating_costs),
            RuleGroup(
                prefix=&#34;GrossOperating&#34;,
                rules=missingsumparts_rules_creator(sum_tag=&#39;GrossProfit&#39;,
                                                    summand_tags=[&#39;OperatingExpenses&#39;,
                                                                  &#39;OperatingIncomeLoss&#39;])),
            CopyTagRule(original=&#39;OperatingExpensesSum&#39;, target=&#39;OperatingExpenses&#39;)
        ])

    is_netincome_rg = RuleGroup(
        prefix=&#34;netincome&#34;,
        rules=[
            # Renaming
            CopyTagRule(
                original=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesExtraordinaryItemsNoncontrollingInterest&#39;,
                target=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;),

            SumUpRule(
                sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                potential_summands=[
                    &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesMinorityInterestAndIncomeLossFromEquityMethodInvestments&#39;,
                ], optional_summands=[&#39;IncomeLossFromEquityMethodInvestments&#39;]),

            CopyTagRule(
                original=&#39;IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest&#39;,
                target=&#39;IncomeLossFromContinuingOperations&#39;),

            SumUpRule(
                sum_tag=&#39;AllIncomeTaxExpenseBenefit&#39;,
                potential_summands=[
                    &#39;IncomeTaxExpenseBenefit&#39;, &#39;DeferredIncomeTaxExpenseBenefit&#39;
                ], optional_summands=[&#39;IncomeLossFromEquityMethodInvestments&#39;]),

            SubtractFromRule(
                target_tag=&#39;IncomeLossFromContinuingOperations&#39;,
                subtract_from_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                potential_subtract_tags=[&#39;AllIncomeTaxExpenseBenefit&#39;]
            ),

            CopyTagRule(
                original=&#39;IncomeLossFromDiscontinuedOperationsNetOfTaxAttributableToReportingEntity&#39;,
                target=&#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;),

            SumUpRule(sum_tag=&#39;ProfitLossParts&#39;,
                      potential_summands=[
                          &#39;IncomeLossFromContinuingOperations&#39;,
                          &#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;
                      ]),

            CopyTagRule(original=&#39;NetIncomeLossParts&#39;, target=&#39;ProfitLoss&#39;),
            # if there is no value for ProfitLoss, we set it to NetIncomeLoss
            CopyTagRule(original=&#39;NetIncomeLoss&#39;, target=&#39;ProfitLoss&#39;),

            # since IncomeLossFromContinuingOperations is part of a validation rule,
            # and if it was not set, we assume that there is only IncomeLossFromContinuingOperations
            # copy the value from ProfitLoss
            CopyTagRule(original=&#39;ProfitLoss&#39;, target=&#39;IncomeLossFromContinuingOperations&#39;),

            # the following rules set the NetIncomeLoss, if not already set.
            # the order of the rules is the precedence
            RuleGroup(prefix=&#34;fill_NIL&#34;,
                      rules=[
                          CopyTagRule(original=&#39;NetIncomeLossAvailableToCommonStockholdersBasic&#39;,
                                      target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;NetIncomeLossAllocatedToLimitedPartners&#39;,
                                      target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;ProfitLoss&#39;, target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(
                              original=&#39;ProfitLossIncludingRedeemableNonControllingInterest&#39;,
                              target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;OtherComprehensiveIncomeLossNetOfTax&#39;,
                                      target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;ComprehensiveIncomeNetOfTax&#39;,
                                      target=&#39;NetIncomeLoss&#39;),

                          # for investment companies
                          CopyTagRule(original=&#39;NetInvestmentIncome&#39;, target=&#39;NetIncomeLoss&#39;),
                      ])
        ]
    )

    is_missing_NTI_PL = RuleGroup(
        prefix=&#34;MissingNTI_PL&#34;,
        rules=missingsumparts_rules_creator(
            sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
            summand_tags=[&#39;IncomeLossFromContinuingOperations&#39;,
                          &#39;AllIncomeTaxExpenseBenefit&#39;]) +
              [
                  MissingSummandRule(sum_tag=&#39;ProfitLoss&#39;,
                                     existing_summands_tags=[&#39;NetIncomeLoss&#39;],
                                     missing_summand_tag=&#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;
                                     )
              ]
    )

    main_rule_tree = RuleGroup(prefix=&#34;IS&#34;,
                               rules=[
                                   is_revenue_rg,
                                   is_costofrevenue_rg,
                                   is_missing_rev_cost_gross,
                                   is_grossProfit,
                                   is_operating,
                                   is_netincome_rg,
                                   is_missing_NTI_PL
                               ])

    preprocess_rule_tree = RuleGroup(prefix=&#34;IS_PRE&#34;,
                                     rules=[
                                     ])

    post_rule_tree = RuleGroup(
        prefix=&#34;IS_POST&#34;,
        rules=[
            PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit(),
            PostFixSign(start_tag=&#39;ProfitLoss&#39;,
                        summand_tag=&#39;AllIncomeTaxExpenseBenefit&#39;,
                        result_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;),
            PostFixSign(start_tag=&#39;NetIncomeLoss&#39;,
                        summand_tag=&#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;,
                        result_tag=&#39;ProfitLoss&#39;),

            # hier noch 2. Rule machen, die nur IncomeTaxExpenseBenefit korrigiert
            #
            # benötigt eine Regel, welche nur IncomeTaxExpenseBenefit korrigiert,
            # falls BeforeTax - AfterTex == 2*incomeTaxExpenseBenefit,
            # bzw. falls BeforeTax + IncomeTaxExpenseBenefit == After Tax

            # 1. if there is no value for Revenues, but GrossProfit
            # we set Revenues to GrossProfit
            # 2. if there is no value for  GrossProfit, but Revenues
            # we set GrossProfit to Revenues
            # 3. in both cases, CostOfRevenue is set to zero with the following
            # MissingSummandRule.
            CopyTagRule(original=&#39;GrossProfit&#39;, target=&#39;Revenues&#39;),
            CopyTagRule(original=&#39;Revenues&#39;, target=&#39;GrossProfit&#39;),
            MissingSummandRule(sum_tag=&#39;Revenues&#39;,
                               existing_summands_tags=[&#39;GrossProfit&#39;],
                               missing_summand_tag=&#39;CostOfRevenue&#39;),
            # Next, we finalize OperatingIncomeLoss, by subtracting
            # a last time the OperatingExpenses from the GrossProfit,
            # if OperatingIncomeLoss is not set
            SubtractFromRule(subtract_from_tag=&#39;GrossProfit&#39;,
                             potential_subtract_tags=[&#39;OperatingExpenses&#39;],
                             target_tag=&#39;OperatingIncomeLoss&#39;),

            # 1. if there is no value for IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit,
            # but for ProfitLoss, we set it to the same value
            # 2. afterward, we set IncomeTaxExpenseBenefit to zero with the following rule
            CopyTagRule(original=&#39;ProfitLoss&#39;,
                        target=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;),
            MissingSummandRule(
                sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                existing_summands_tags=[&#39;ProfitLoss&#39;],
                missing_summand_tag=&#39;AllIncomeTaxExpenseBenefit&#39;),

            PostSetToZero(tags=[&#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;]),

        ])

    validation_rules: List[ValidationRule] = [
        SumValidationRule(identifier=&#34;RevCogGrossCheck&#34;,
                          sum_tag=&#39;Revenues&#39;,
                          summands=[&#39;CostOfRevenue&#39;, &#39;GrossProfit&#39;]),
        SumValidationRule(identifier=&#34;GrossCstopOpinc&#34;,
                          sum_tag=&#39;GrossProfit&#39;,
                          summands=[&#39;OperatingExpenses&#39;, &#39;OperatingIncomeLoss&#39;]),
        SumValidationRule(identifier=&#34;ContIncTax&#34;,
                          sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                          summands=[&#39;AllIncomeTaxExpenseBenefit&#39;,
                                    &#39;IncomeLossFromContinuingOperations&#39;]),
        SumValidationRule(identifier=&#39;ProfitLoss&#39;,
                          sum_tag=&#39;ProfitLoss&#39;,
                          summands=[
                              &#39;IncomeLossFromContinuingOperations&#39;,
                              &#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;
                          ]),
        SumValidationRule(identifier=&#39;NetIncomeLoss&#39;,
                          sum_tag=&#39;ProfitLoss&#39;,
                          summands=[
                              &#39;NetIncomeLoss&#39;,
                              &#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;
                          ]),

    ]

    # these are the columns that finally are returned after the standardization
    final_tags: List[str] = [&#39;Revenues&#39;,
                             &#39;CostOfRevenue&#39;,
                             &#39;GrossProfit&#39;,
                             &#39;OperatingExpenses&#39;,
                             &#39;OperatingIncomeLoss&#39;,
                             &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                             &#39;AllIncomeTaxExpenseBenefit&#39;,
                             &#39;IncomeLossFromContinuingOperations&#39;,
                             &#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;,
                             &#39;ProfitLoss&#39;,
                             &#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;,
                             &#39;NetIncomeLoss&#39;
                             ]

    # used to evaluate if a report is the main balancesheet report
    # inside a report, there can be several tables (different report nr)
    # which stmt value is BS.
    # however, we might be only interested in the &#34;major&#34; BS report. Usually this is the
    # one which has the least nan in the following columns
    main_statement_tags = [&#39;Revenues&#39;,
                           &#39;SalesRevenueNet&#39;,
                           &#39;SalesRevenueGoodsNet&#39;,
                           &#39;SalesRevenueServicesNet&#39;,
                           &#39;CostOfRevenue&#39;,
                           &#39;CostOfGoodsAndServicesSold&#39;,
                           &#39;CostOfGoodsSold&#39;,
                           &#39;CostOfServices&#39;,
                           &#39;GrossProfit&#39;,
                           &#39;OperatingExpenses&#39;,
                           &#39;OperatingIncomeLoss&#39;,
                           &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesMinorityInterestAndIncomeLossFromEquityMethodInvestments&#39;,
                           &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesExtraordinaryItemsNoncontrollingInterest&#39;,
                           &#39;IncomeLossBeforeIncomeTaxExpenseBenefit&#39;,
                           &#39;IncomeTaxExpenseBenefit&#39;,
                           &#39;DeferredIncomeTaxExpenseBenefit&#39;,
                           &#39;NetIncomeLoss&#39;,
                           &#39;ProfitLoss&#39;
                           ]

    def __init__(self, filter_for_main_statement: bool = True, iterations: int = 3):
        super().__init__(
            prepivot_rule_tree=self.prepivot_rule_tree,
            pre_rule_tree=self.preprocess_rule_tree,
            main_rule_tree=self.main_rule_tree,
            post_rule_tree=self.post_rule_tree,
            validation_rules=self.validation_rules,
            final_tags=self.final_tags,
            main_iterations=iterations,
            filter_for_main_statement=filter_for_main_statement,
            main_statement_tags=self.main_statement_tags)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer"><code class="flex name class">
<span>class <span class="ident">IncomeStatementStandardizer</span></span>
<span>(</span><span>filter_for_main_statement: bool = True, iterations: int = 3)</span>
</code></dt>
<dd>
<div class="desc"><p>The goal of this Standardizer is to create IncomeStatements that are comparable,
meaning that they have the same tags.</p>
<p>At the end, the standardized IS contains the following columns</p>
<p>Position
Relation</p>
<p>Revenues
+ SalesRevenueGoodsNet
+ SalesRevenueServicesNet
+ OtherSalesRevenueNet
--------------
or SalesRevenueNet</p>
<pre><code>or RevenuesSum
      RevenueFromContractWithCustomerExcludingAssessedTax
      RevenueFromContractWithCustomerIncludingAssessedTax
      RevenuesExcludingInterestAndDividends
      RegulatedAndUnregulatedOperatingRevenue
      ...

or InterestAndDividendIncomeOperating
--------
Revenues
========
</code></pre>
<p>CostOfRevenue
'CostOfGoodsSold',
+ 'CostOfServices'
---------------
'CostOfGoodsAndServicesSold',
+ 'LicenseCost',
----------------
'CostOfRevenue',
================</p>
<p>Gross Profit
Revenues - Cost of Goods and Services Sold
Operating Expenses</p>
<p>Operating Income (Loss)
Gross Profit - Operating Expenses
Other Income and Expenses</p>
<p>Income Before Tax
Operating Income + Other Income and Expenses
Income Tax Expense (Benefit)</p>
<p>Net Income (Loss)
Income Before Tax - Income Tax Expense</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>prepivot_rule_tree</code></strong></dt>
<dd>rules that are applied before the data is pivoted. These are rules
that filter (like deduplicate) or correct values.</dd>
<dt><strong><code>pre_rule_tree</code></strong></dt>
<dd>rules that are applied once before the main processing. These are mainly
rules that try to correct existing data from obvious errors (like wrong
tagging)</dd>
<dt><strong><code>main_rule_tree</code></strong></dt>
<dd>rules that are applied during the main processing rule and which do the
heavy lifting. These rules can be excuted multipe times depending on the value
of the main_iterations parameter</dd>
<dt><strong><code>post_rule_tree</code></strong></dt>
<dd>rules that are used to "cleanup", like setting certain values to
0.0</dd>
<dt><strong><code>validation_rules</code></strong></dt>
<dd>Validation rules are applied after all rules were applied.
they add validation columns to the main dataset. Validation rules do check
if certain requirements are met. E.g. in a Balance Sheet, the following
equation should be true: Assets = AssetsCurrent + AssetsNoncurrent</dd>
<dt><strong><code>main_iterations</code></strong></dt>
<dd>defining the number of iterations the main rules should be applied</dd>
<dt><strong><code>final_tags</code></strong></dt>
<dd>tbd</dd>
<dt><strong><code>filter_for_main_statement</code></strong> :&ensp;<code>bool, Optional, True</code></dt>
<dd>depending on the data, it could look
as if multiple Balance Sheets statements could be present in a single report.
However, there should only be one. Setting
this flag to true (which is the default), tries to select the one that is most
likely the real statement.
the tags that are used are defined in the main_statement_tags parameter</dd>
<dt><strong><code>main_statement_tags</code></strong></dt>
<dd>tbd</dd>
<dt><strong><code>invert_negated</code></strong> :&ensp;<code>bool, Optional, True</code></dt>
<dd>inverts the value of the that are marked
as negated.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class IncomeStatementStandardizer(Standardizer):
    &#34;&#34;&#34;
    The goal of this Standardizer is to create IncomeStatements that are comparable,
    meaning that they have the same tags.

    At the end, the standardized IS contains the following columns

    Position    Relation

    Revenues
           + SalesRevenueGoodsNet
           + SalesRevenueServicesNet
           + OtherSalesRevenueNet
           --------------
        or SalesRevenueNet

        or RevenuesSum
              RevenueFromContractWithCustomerExcludingAssessedTax
              RevenueFromContractWithCustomerIncludingAssessedTax
              RevenuesExcludingInterestAndDividends
              RegulatedAndUnregulatedOperatingRevenue
              ...

        or InterestAndDividendIncomeOperating
        --------
        Revenues
        ========

    CostOfRevenue
          &#39;CostOfGoodsSold&#39;,
        + &#39;CostOfServices&#39;
        ---------------
          &#39;CostOfGoodsAndServicesSold&#39;,
        + &#39;LicenseCost&#39;,
        ----------------
          &#39;CostOfRevenue&#39;,
        ================


    Gross Profit                        Revenues - Cost of Goods and Services Sold
    Operating Expenses

    Operating Income (Loss)             Gross Profit - Operating Expenses
    Other Income and Expenses

    Income Before Tax               Operating Income + Other Income and Expenses
    Income Tax Expense (Benefit)

    Net Income (Loss)               Income Before Tax - Income Tax Expense
    &#34;&#34;&#34;
    prepivot_rule_tree = RuleGroup(
        prefix=&#34;IS_PREPIV&#34;,
        rules=[PrePivotDeduplicate(),
               PrePivotCorrectSign(
                   # all these tags are costOf and therefore should appear as positive
                   tag_list=[&#39;CostOfGoodsSold&#39;,
                             &#39;CostOfServices&#39;,
                             &#39;CostOfGoodsAndServicesSold&#39;,
                             &#39;CostOfRevenue&#39;,
                             &#39;CostOfGoodsSoldExcludingDepreciationDepletionAndAmortization&#39;,
                             &#39;CostOfGoodsSoldDepreciationDepletionAndAmortization&#39;,
                             &#39;CostOfGoodsSoldDepletion&#39;,
                             &#39;CostOfGoodsSoldDepreciation&#39;,
                             &#39;CostOfGoodsSoldAmortization&#39;,
                             &#39;CostOfGoodsSoldDepreciationAndAmortization&#39;,
                             &#39;CostOfGoodsSoldDirectFinancingLease&#39;,
                             &#39;CostOfGoodsSoldElectric&#39;,
                             &#39;CostOfGoodsSoldDirectMaterials&#39;,
                             &#39;CostOfGoodsSoldDirectLabor&#39;,
                             &#39;CostOfGoodsSoldOverhead&#39;,
                             &#39;CostOfGoodsSoldOilAndGas&#39;,
                             &#39;CostOfGoodsSoldSubscription&#39;,
                             &#39;CostOfGoodsSoldDirectTaxesAndLicensesCosts&#39;,
                             &#39;CostOfGoodsSoldMaintenanceCosts&#39;,
                             &#39;CostOfGoodsSoldSalesTypeLease&#39;,
                             &#39;CostOfServicesExcludingDepreciationDepletionAndAmortization&#39;,
                             &#39;CostOfServicesDepreciation&#39;,
                             &#39;CostOfServicesDepreciationAndAmortization&#39;,
                             &#39;CostOfServicesCatering&#39;,
                             &#39;CostOfServicesAmortization&#39;,
                             &#39;CostOfServicesOilAndGas&#39;,
                             &#39;CostOfServicesDirectTaxesAndLicensesCosts&#39;,
                             &#39;CostOfServicesMaintenanceCosts&#39;,
                             &#39;CostOfServicesLicensesAndServices&#39;,
                             &#39;CostOfServicesDirectLabor&#39;,
                             &#39;CostOfServicesLicensesAndMaintenanceAgreements&#39;,
                             &#39;CostOfServicesEnergyServices&#39;,
                             &#39;CostOfServicesDirectMaterials&#39;,
                             &#39;CostOfServicesEnvironmentalRemediation&#39;,
                             &#39;CostOfServicesOverhead&#39;,
                             &#39;CostOfGoodsAndServicesSoldDepreciationAndAmortization&#39;,
                             &#39;CostOfGoodsAndServicesSoldAmortization&#39;,
                             &#39;CostOfGoodsAndServicesSoldOverhead&#39;,
                             &#39;CostOfGoodsAndServicesSoldDepreciation&#39;,
                             &#39;CostOfGoodsAndServicesEnergyCommoditiesAndServices&#39;,
                             &#39;CostOfGoodsAndServiceExcludingDepreciationDepletionAndAmortization&#39;
                             ],
                   is_positive=True
               )]
    )

    is_revenue_rg = RuleGroup(
        prefix=&#34;Rev&#34;,
        rules=[
            # normally, (Goods and Services) Gross and Net appear together, resp. Net has priority.
            # so if net is not present, we copy the gross value in the net value
            # and then sum the nets up to the SalesRevenue
            CopyTagRule(
                original=&#39;SalesRevenueGoodsGross&#39;,
                target=&#39;SalesRevenueGoodsNet&#39;),

            CopyTagRule(
                original=&#39;SalesRevenueServicesGross&#39;,
                target=&#39;SalesRevenueServicesNet&#39;),

            SumUpRule(sum_tag=&#39;SalesRevenueNet&#39;,
                      potential_summands=[
                          &#39;SalesRevenueGoodsNet&#39;,
                          &#39;SalesRevenueServicesNet&#39;],
                      optional_summands=[
                          &#39;OtherSalesRevenueNet&#39;
                      ]),
            # if the Revenues is not set, we copy SalesRevenuesNet into Revenues
            CopyTagRule(original=&#39;SalesRevenueNet&#39;, target=&#39;Revenues&#39;),

            # RevenueFromContractWithCustomer-tags are also often used to report the
            # total Revenue. so the following rules take care of these cases.
            # the order of the rules also defines the precedence.
            # first: if RevenueFromContractWithCustomerExcludingAssessedTax is not set
            #    we calculate it from RevenueFromContractWithCustomerIncludingAssessedTax
            #          and ExciseAndSalesTaxes (if present)
            SubtractFromRule(
                subtract_from_tag=&#39;RevenueFromContractWithCustomerIncludingAssessedTax&#39;,
                potential_subtract_tags=[&#39;ExciseAndSalesTaxes&#39;],
                target_tag=&#39;RevenueFromContractWithCustomerExcludingAssessedTax&#39;),

            # second Excluding has the higher precedence than Including
            CopyTagRule(original=&#39;RevenueFromContractWithCustomerExcludingAssessedTax&#39;,
                        target=&#39;Revenues&#39;),
            CopyTagRule(original=&#39;RevenueFromContractWithCustomerIncludingAssessedTax&#39;,
                        target=&#39;Revenues&#39;),

            # if Revenues couldn&#39;t be defined so far, RevenuesExcludingInterestAndDividends
            # is also a tag that is commonly used to define the total Revenue
            CopyTagRule(original=&#39;RevenuesExcludingInterestAndDividends&#39;,
                        target=&#39;Revenues&#39;),

            # if we were not able to define the Revenue so far, there are
            # a couple of other tags which define Revenue, so we count them together
            # and set the total as Revenue
            SumUpRule(sum_tag=&#39;RevenuesSum&#39;,
                      potential_summands=[
                          &#39;RegulatedAndUnregulatedOperatingRevenue&#39;,
                          &#39;HealthCareOrganizationPatientServiceRevenue&#39;,
                          &#39;ContractsRevenue&#39;,
                          &#39;RevenueOilAndGasServices&#39;,
                          &#39;HealthCareOrganizationRevenue&#39;,
                          &#39;RevenueMineralSales&#39;,
                          &#39;SalesRevenueEnergyServices&#39;,
                          &#39;RealEstateRevenueNet&#39;,
                          &#39;OperatingLeasesIncomeStatementLeaseRevenue&#39;,
                          &#39;LicensesRevenue&#39;, &#39;RevenueFromRelatedParties&#39;,
                          &#39;BrokerageCommissionsRevenue&#39;, &#39;RoyaltyRevenue&#39;, &#39;OilAndGasSalesRevenue&#39;,
                          &#39;OilAndGasRevenue&#39;, &#39;OtherRealEstateRevenue&#39;,
                          &#39;TechnologyServicesRevenue&#39;, &#39;ManagementFeesRevenue&#39;,
                          &#39;ReimbursementRevenue&#39;,
                          &#39;OperatingLeasesIncomeStatementMinimumLeaseRevenue&#39;,
                          &#39;FoodAndBeverageRevenue&#39;, &#39;MaintenanceRevenue&#39;,
                          &#39;LicenseAndServicesRevenue&#39;, &#39;FranchiseRevenue&#39;, &#39;SubscriptionRevenue&#39;,
                          &#39;FinancialServicesRevenue&#39;,
                          &#39;RevenueFromGrants&#39;,
                          &#39;GasGatheringTransportationMarketingAndProcessingRevenue&#39;,
                          &#39;OccupancyRevenue&#39;, &#39;NaturalGasProductionRevenue&#39;,
                          &#39;SalesRevenueServicesGross&#39;, &#39;InvestmentBankingRevenue&#39;,
                          &#39;AdvertisingRevenue&#39;, &#39;RevenueOtherFinancialServices&#39;,
                          &#39;OilAndCondensateRevenue&#39;, &#39;RevenueFromLeasedAndOwnedHotels&#39;,
                          &#39;RevenuesNetOfInterestExpense&#39;, &#39;RegulatedAndUnregulatedOperatingRevenue&#39;,
                          &#39;UnregulatedOperatingRevenue&#39;, &#39;ElectricUtilityRevenue&#39;,
                          &#39;CargoAndFreightRevenue&#39;, &#39;OtherHotelOperatingRevenue&#39;,
                          &#39;CasinoRevenue&#39;, &#39;RefiningAndMarketingRevenue&#39;,
                          &#39;PrincipalTransactionsRevenue&#39;, &#39;InterestRevenueExpenseNet&#39;,
                          &#39;HomeBuildingRevenue&#39;, &#39;OtherRevenueExpenseFromRealEstateOperations&#39;,
                          &#39;GasDomesticRegulatedRevenue&#39;, &#39;LicenseAndMaintenanceRevenue&#39;,
                          &#39;RegulatedOperatingRevenue&#39;, &#39;AdmissionsRevenue&#39;, &#39;PassengerRevenue&#39;
                      ],
                      optional_summands=[
                          &#39;OtherSalesRevenueNet&#39;
                      ]),

            CopyTagRule(original=&#39;RevenuesSum&#39;, target=&#39;Revenues&#39;),
            # if there is nothing else
            CopyTagRule(original=&#39;InvestmentIncomeInterest&#39;, target=&#39;Revenues&#39;)
        ]
    )

    is_costofrevenue_rg = RuleGroup(
        prefix=&#34;costrevenue&#34;,
        rules=[
            SumUpRule(sum_tag=&#39;CostOfGoodsSold&#39;,
                      potential_summands=[
                          &#39;CostOfGoodsSoldExcludingDepreciationDepletionAndAmortization&#39;,
                          &#39;CostOfGoodsSoldDepreciationDepletionAndAmortization&#39;,
                          &#39;CostOfGoodsSoldDepletion&#39;,
                          &#39;CostOfGoodsSoldDepreciation&#39;,
                          &#39;CostOfGoodsSoldAmortization&#39;,
                          &#39;CostOfGoodsSoldDepreciationAndAmortization&#39;,
                          &#39;CostOfGoodsSoldDirectFinancingLease&#39;,
                          &#39;CostOfGoodsSoldElectric&#39;,
                          &#39;CostOfGoodsSoldDirectMaterials&#39;,
                          &#39;CostOfGoodsSoldDirectLabor&#39;,
                          &#39;CostOfGoodsSoldOverhead&#39;,
                          &#39;CostOfGoodsSoldOilAndGas&#39;,
                          &#39;CostOfGoodsSoldSubscription&#39;,
                          &#39;CostOfGoodsSoldDirectTaxesAndLicensesCosts&#39;,
                          &#39;CostOfGoodsSoldMaintenanceCosts&#39;,
                          &#39;CostOfGoodsSoldSalesTypeLease&#39;]),

            SumUpRule(sum_tag=&#39;CostOfServices&#39;,
                      potential_summands=[
                          &#39;CostOfServicesExcludingDepreciationDepletionAndAmortization&#39;,
                          &#39;CostOfServicesDepreciation&#39;,
                          &#39;CostOfServicesDepreciationAndAmortization&#39;,
                          &#39;CostOfServicesCatering&#39;,
                          &#39;CostOfServicesAmortization&#39;,
                          &#39;CostOfServicesOilAndGas&#39;,
                          &#39;CostOfServicesDirectTaxesAndLicensesCosts&#39;,
                          &#39;CostOfServicesMaintenanceCosts&#39;,
                          &#39;CostOfServicesLicensesAndServices&#39;,
                          &#39;CostOfServicesDirectLabor&#39;,
                          &#39;CostOfServicesLicensesAndMaintenanceAgreements&#39;,
                          &#39;CostOfServicesEnergyServices&#39;,
                          &#39;CostOfServicesDirectMaterials&#39;,
                          &#39;CostOfServicesEnvironmentalRemediation&#39;,
                          &#39;CostOfServicesOverhead&#39;
                      ]),

            SumUpRule(sum_tag=&#39;CostOfGoodsAndServicesSold&#39;,
                      potential_summands=[
                          &#39;CostOfGoodsSold&#39;,
                          &#39;CostOfServices&#39;]),

            SumUpRule(sum_tag=&#39;CostOfGoodsAndServicesSold&#39;,
                      potential_summands=[
                          &#39;CostOfGoodsAndServicesSoldDepreciationAndAmortization&#39;,
                          &#39;CostOfGoodsAndServicesSoldAmortization&#39;,
                          &#39;CostOfGoodsAndServicesSoldOverhead&#39;,
                          &#39;CostOfGoodsAndServicesSoldDepreciation&#39;,
                          &#39;CostOfGoodsAndServicesEnergyCommoditiesAndServices&#39;,
                          &#39;CostOfGoodsAndServiceExcludingDepreciationDepletionAndAmortization&#39;]
                      ),
            CopyTagRule(original=&#39;CostOfGoodsAndServicesSold&#39;, target=&#39;CostOfRevenue&#39;),
        ]
    )

    # GrossProfit is the only tag used to indicate GrossProfit

    is_missing_rev_cost_gross = RuleGroup(
        prefix=&#34;RevCostGross&#34;,
        rules=missingsumparts_rules_creator(sum_tag=&#39;Revenues&#39;,
                                            summand_tags=[&#39;CostOfRevenue&#39;, &#39;GrossProfit&#39;])
    )

    is_grossProfit = RuleGroup(
        prefix=&#39;grossprofit&#39;,
        rules=[
            # for investment companies
            CopyTagRule(original=&#39;GrossInvestmentIncomeOperating&#39;, target=&#39;GrossProfit&#39;),
            CopyTagRule(original=&#39;InterestAndDividendIncomeOperating&#39;, target=&#39;GrossProfit&#39;)
        ]
    )

    is_operating = RuleGroup(
        prefix=&#34;operating&#34;,
        rules=[
            SumUpRule(sum_tag=&#39;OperatingExpensesSum&#39;,
                      potential_summands=top_100_operating_costs),
            RuleGroup(
                prefix=&#34;GrossOperating&#34;,
                rules=missingsumparts_rules_creator(sum_tag=&#39;GrossProfit&#39;,
                                                    summand_tags=[&#39;OperatingExpenses&#39;,
                                                                  &#39;OperatingIncomeLoss&#39;])),
            CopyTagRule(original=&#39;OperatingExpensesSum&#39;, target=&#39;OperatingExpenses&#39;)
        ])

    is_netincome_rg = RuleGroup(
        prefix=&#34;netincome&#34;,
        rules=[
            # Renaming
            CopyTagRule(
                original=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesExtraordinaryItemsNoncontrollingInterest&#39;,
                target=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;),

            SumUpRule(
                sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                potential_summands=[
                    &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesMinorityInterestAndIncomeLossFromEquityMethodInvestments&#39;,
                ], optional_summands=[&#39;IncomeLossFromEquityMethodInvestments&#39;]),

            CopyTagRule(
                original=&#39;IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest&#39;,
                target=&#39;IncomeLossFromContinuingOperations&#39;),

            SumUpRule(
                sum_tag=&#39;AllIncomeTaxExpenseBenefit&#39;,
                potential_summands=[
                    &#39;IncomeTaxExpenseBenefit&#39;, &#39;DeferredIncomeTaxExpenseBenefit&#39;
                ], optional_summands=[&#39;IncomeLossFromEquityMethodInvestments&#39;]),

            SubtractFromRule(
                target_tag=&#39;IncomeLossFromContinuingOperations&#39;,
                subtract_from_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                potential_subtract_tags=[&#39;AllIncomeTaxExpenseBenefit&#39;]
            ),

            CopyTagRule(
                original=&#39;IncomeLossFromDiscontinuedOperationsNetOfTaxAttributableToReportingEntity&#39;,
                target=&#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;),

            SumUpRule(sum_tag=&#39;ProfitLossParts&#39;,
                      potential_summands=[
                          &#39;IncomeLossFromContinuingOperations&#39;,
                          &#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;
                      ]),

            CopyTagRule(original=&#39;NetIncomeLossParts&#39;, target=&#39;ProfitLoss&#39;),
            # if there is no value for ProfitLoss, we set it to NetIncomeLoss
            CopyTagRule(original=&#39;NetIncomeLoss&#39;, target=&#39;ProfitLoss&#39;),

            # since IncomeLossFromContinuingOperations is part of a validation rule,
            # and if it was not set, we assume that there is only IncomeLossFromContinuingOperations
            # copy the value from ProfitLoss
            CopyTagRule(original=&#39;ProfitLoss&#39;, target=&#39;IncomeLossFromContinuingOperations&#39;),

            # the following rules set the NetIncomeLoss, if not already set.
            # the order of the rules is the precedence
            RuleGroup(prefix=&#34;fill_NIL&#34;,
                      rules=[
                          CopyTagRule(original=&#39;NetIncomeLossAvailableToCommonStockholdersBasic&#39;,
                                      target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;NetIncomeLossAllocatedToLimitedPartners&#39;,
                                      target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;ProfitLoss&#39;, target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(
                              original=&#39;ProfitLossIncludingRedeemableNonControllingInterest&#39;,
                              target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;OtherComprehensiveIncomeLossNetOfTax&#39;,
                                      target=&#39;NetIncomeLoss&#39;),
                          CopyTagRule(original=&#39;ComprehensiveIncomeNetOfTax&#39;,
                                      target=&#39;NetIncomeLoss&#39;),

                          # for investment companies
                          CopyTagRule(original=&#39;NetInvestmentIncome&#39;, target=&#39;NetIncomeLoss&#39;),
                      ])
        ]
    )

    is_missing_NTI_PL = RuleGroup(
        prefix=&#34;MissingNTI_PL&#34;,
        rules=missingsumparts_rules_creator(
            sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
            summand_tags=[&#39;IncomeLossFromContinuingOperations&#39;,
                          &#39;AllIncomeTaxExpenseBenefit&#39;]) +
              [
                  MissingSummandRule(sum_tag=&#39;ProfitLoss&#39;,
                                     existing_summands_tags=[&#39;NetIncomeLoss&#39;],
                                     missing_summand_tag=&#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;
                                     )
              ]
    )

    main_rule_tree = RuleGroup(prefix=&#34;IS&#34;,
                               rules=[
                                   is_revenue_rg,
                                   is_costofrevenue_rg,
                                   is_missing_rev_cost_gross,
                                   is_grossProfit,
                                   is_operating,
                                   is_netincome_rg,
                                   is_missing_NTI_PL
                               ])

    preprocess_rule_tree = RuleGroup(prefix=&#34;IS_PRE&#34;,
                                     rules=[
                                     ])

    post_rule_tree = RuleGroup(
        prefix=&#34;IS_POST&#34;,
        rules=[
            PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit(),
            PostFixSign(start_tag=&#39;ProfitLoss&#39;,
                        summand_tag=&#39;AllIncomeTaxExpenseBenefit&#39;,
                        result_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;),
            PostFixSign(start_tag=&#39;NetIncomeLoss&#39;,
                        summand_tag=&#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;,
                        result_tag=&#39;ProfitLoss&#39;),

            # hier noch 2. Rule machen, die nur IncomeTaxExpenseBenefit korrigiert
            #
            # benötigt eine Regel, welche nur IncomeTaxExpenseBenefit korrigiert,
            # falls BeforeTax - AfterTex == 2*incomeTaxExpenseBenefit,
            # bzw. falls BeforeTax + IncomeTaxExpenseBenefit == After Tax

            # 1. if there is no value for Revenues, but GrossProfit
            # we set Revenues to GrossProfit
            # 2. if there is no value for  GrossProfit, but Revenues
            # we set GrossProfit to Revenues
            # 3. in both cases, CostOfRevenue is set to zero with the following
            # MissingSummandRule.
            CopyTagRule(original=&#39;GrossProfit&#39;, target=&#39;Revenues&#39;),
            CopyTagRule(original=&#39;Revenues&#39;, target=&#39;GrossProfit&#39;),
            MissingSummandRule(sum_tag=&#39;Revenues&#39;,
                               existing_summands_tags=[&#39;GrossProfit&#39;],
                               missing_summand_tag=&#39;CostOfRevenue&#39;),
            # Next, we finalize OperatingIncomeLoss, by subtracting
            # a last time the OperatingExpenses from the GrossProfit,
            # if OperatingIncomeLoss is not set
            SubtractFromRule(subtract_from_tag=&#39;GrossProfit&#39;,
                             potential_subtract_tags=[&#39;OperatingExpenses&#39;],
                             target_tag=&#39;OperatingIncomeLoss&#39;),

            # 1. if there is no value for IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit,
            # but for ProfitLoss, we set it to the same value
            # 2. afterward, we set IncomeTaxExpenseBenefit to zero with the following rule
            CopyTagRule(original=&#39;ProfitLoss&#39;,
                        target=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;),
            MissingSummandRule(
                sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                existing_summands_tags=[&#39;ProfitLoss&#39;],
                missing_summand_tag=&#39;AllIncomeTaxExpenseBenefit&#39;),

            PostSetToZero(tags=[&#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;]),

        ])

    validation_rules: List[ValidationRule] = [
        SumValidationRule(identifier=&#34;RevCogGrossCheck&#34;,
                          sum_tag=&#39;Revenues&#39;,
                          summands=[&#39;CostOfRevenue&#39;, &#39;GrossProfit&#39;]),
        SumValidationRule(identifier=&#34;GrossCstopOpinc&#34;,
                          sum_tag=&#39;GrossProfit&#39;,
                          summands=[&#39;OperatingExpenses&#39;, &#39;OperatingIncomeLoss&#39;]),
        SumValidationRule(identifier=&#34;ContIncTax&#34;,
                          sum_tag=&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                          summands=[&#39;AllIncomeTaxExpenseBenefit&#39;,
                                    &#39;IncomeLossFromContinuingOperations&#39;]),
        SumValidationRule(identifier=&#39;ProfitLoss&#39;,
                          sum_tag=&#39;ProfitLoss&#39;,
                          summands=[
                              &#39;IncomeLossFromContinuingOperations&#39;,
                              &#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;
                          ]),
        SumValidationRule(identifier=&#39;NetIncomeLoss&#39;,
                          sum_tag=&#39;ProfitLoss&#39;,
                          summands=[
                              &#39;NetIncomeLoss&#39;,
                              &#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;
                          ]),

    ]

    # these are the columns that finally are returned after the standardization
    final_tags: List[str] = [&#39;Revenues&#39;,
                             &#39;CostOfRevenue&#39;,
                             &#39;GrossProfit&#39;,
                             &#39;OperatingExpenses&#39;,
                             &#39;OperatingIncomeLoss&#39;,
                             &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                             &#39;AllIncomeTaxExpenseBenefit&#39;,
                             &#39;IncomeLossFromContinuingOperations&#39;,
                             &#39;IncomeLossFromDiscontinuedOperationsNetOfTax&#39;,
                             &#39;ProfitLoss&#39;,
                             &#39;NetIncomeLossAttributableToNoncontrollingInterest&#39;,
                             &#39;NetIncomeLoss&#39;
                             ]

    # used to evaluate if a report is the main balancesheet report
    # inside a report, there can be several tables (different report nr)
    # which stmt value is BS.
    # however, we might be only interested in the &#34;major&#34; BS report. Usually this is the
    # one which has the least nan in the following columns
    main_statement_tags = [&#39;Revenues&#39;,
                           &#39;SalesRevenueNet&#39;,
                           &#39;SalesRevenueGoodsNet&#39;,
                           &#39;SalesRevenueServicesNet&#39;,
                           &#39;CostOfRevenue&#39;,
                           &#39;CostOfGoodsAndServicesSold&#39;,
                           &#39;CostOfGoodsSold&#39;,
                           &#39;CostOfServices&#39;,
                           &#39;GrossProfit&#39;,
                           &#39;OperatingExpenses&#39;,
                           &#39;OperatingIncomeLoss&#39;,
                           &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesMinorityInterestAndIncomeLossFromEquityMethodInvestments&#39;,
                           &#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxesExtraordinaryItemsNoncontrollingInterest&#39;,
                           &#39;IncomeLossBeforeIncomeTaxExpenseBenefit&#39;,
                           &#39;IncomeTaxExpenseBenefit&#39;,
                           &#39;DeferredIncomeTaxExpenseBenefit&#39;,
                           &#39;NetIncomeLoss&#39;,
                           &#39;ProfitLoss&#39;
                           ]

    def __init__(self, filter_for_main_statement: bool = True, iterations: int = 3):
        super().__init__(
            prepivot_rule_tree=self.prepivot_rule_tree,
            pre_rule_tree=self.preprocess_rule_tree,
            main_rule_tree=self.main_rule_tree,
            post_rule_tree=self.post_rule_tree,
            validation_rules=self.validation_rules,
            final_tags=self.final_tags,
            main_iterations=iterations,
            filter_for_main_statement=filter_for_main_statement,
            main_statement_tags=self.main_statement_tags)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="secfsdstools.f_standardize.standardizing.Standardizer" href="standardizing.html#secfsdstools.f_standardize.standardizing.Standardizer">Standardizer</a></li>
<li><a title="secfsdstools.d_container.presentation.Presenter" href="../d_container/presentation.html#secfsdstools.d_container.presentation.Presenter">Presenter</a></li>
<li>typing.Generic</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.final_tags"><code class="name">var <span class="ident">final_tags</span> : List[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_costofrevenue_rg"><code class="name">var <span class="ident">is_costofrevenue_rg</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_grossProfit"><code class="name">var <span class="ident">is_grossProfit</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_missing_NTI_PL"><code class="name">var <span class="ident">is_missing_NTI_PL</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_missing_rev_cost_gross"><code class="name">var <span class="ident">is_missing_rev_cost_gross</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_netincome_rg"><code class="name">var <span class="ident">is_netincome_rg</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_operating"><code class="name">var <span class="ident">is_operating</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_revenue_rg"><code class="name">var <span class="ident">is_revenue_rg</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.main_rule_tree"><code class="name">var <span class="ident">main_rule_tree</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.main_statement_tags"><code class="name">var <span class="ident">main_statement_tags</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.post_rule_tree"><code class="name">var <span class="ident">post_rule_tree</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.prepivot_rule_tree"><code class="name">var <span class="ident">prepivot_rule_tree</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.preprocess_rule_tree"><code class="name">var <span class="ident">preprocess_rule_tree</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.validation_rules"><code class="name">var <span class="ident">validation_rules</span> : List[<a title="secfsdstools.f_standardize.base_validation_rules.ValidationRule" href="base_validation_rules.html#secfsdstools.f_standardize.base_validation_rules.ValidationRule">ValidationRule</a>]</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="secfsdstools.f_standardize.standardizing.Standardizer" href="standardizing.html#secfsdstools.f_standardize.standardizing.Standardizer">Standardizer</a></b></code>:
<ul class="hlist">
<li><code><a title="secfsdstools.f_standardize.standardizing.Standardizer.get_process_description" href="standardizing.html#secfsdstools.f_standardize.standardizing.Standardizer.get_process_description">get_process_description</a></code></li>
<li><code><a title="secfsdstools.f_standardize.standardizing.Standardizer.get_standardize_bag" href="standardizing.html#secfsdstools.f_standardize.standardizing.Standardizer.get_standardize_bag">get_standardize_bag</a></code></li>
<li><code><a title="secfsdstools.f_standardize.standardizing.Standardizer.present" href="standardizing.html#secfsdstools.f_standardize.standardizing.Standardizer.present">present</a></code></li>
<li><code><a title="secfsdstools.f_standardize.standardizing.Standardizer.process" href="standardizing.html#secfsdstools.f_standardize.standardizing.Standardizer.process">process</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit"><code class="flex name class">
<span>class <span class="ident">PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit</span></span>
</code></dt>
<dd>
<div class="desc"><p>Usually, when TaxExpenseBenefit is a positive number, meaning that this amount
of taxes were paid by the company. Therefore, the equation</p>
<p>IncomeLossBeforeTaxes - TaxExpenseBenefit = NetIncomeLoss</p>
<p>However, there
is a quite significant number of reports, which us a negative
number to display paid Taxes and therefore, the following equations would be
used:</p>
<p>IncomeLossBeforeTaxes + TaxExpenseBenefit = NetIncomeLoss</p>
<p>This rule select these entries and tries to fix that, whenever possible.</p>
<p>Since the rules calculate IncomeLossFromContinuingOperations as follows</p>
<p>IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit
- IncomeTaxExpenseBenefit
= IncomeLossFromContinuingOperations</p>
<p>We might end up having a wrong value for IncomeLossFromContinuingOperation.</p>
<p>Therefore, we mask the entries, where</p>
<p>abs(NetIncomeLoss - IncomeLossFromContinuingOperations) = 2*abs(IncomeTaxExpenseBenefit)
if IncomeTaxExpenseBenefit &gt; 0</p>
<p>in order to fix the sign for IncomeTaxExpenseBenefit and to correct
IncomeLossFromContinuingOperations</p>
<p>The rule also uses some threshold.</p>
<p>Of course, this is not perfect and does not consider the cases with DiscontinuedOperations,
However, it is able to fix a significant number of cases.</p>
<p>For the masked entries, it changes the sign of TaxExpenseBenefit
and recalculates IncomeLossFromContinuingOperations</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit(Rule):
    &#34;&#34;&#34;
    Usually, when TaxExpenseBenefit is a positive number, meaning that this amount
    of taxes were paid by the company. Therefore, the equation

    IncomeLossBeforeTaxes - TaxExpenseBenefit = NetIncomeLoss

    However, there  is a quite significant number of reports, which us a negative
    number to display paid Taxes and therefore, the following equations would be
    used:

    IncomeLossBeforeTaxes + TaxExpenseBenefit = NetIncomeLoss

    This rule select these entries and tries to fix that, whenever possible.

    Since the rules calculate IncomeLossFromContinuingOperations as follows

    IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit
    - IncomeTaxExpenseBenefit
    = IncomeLossFromContinuingOperations

    We might end up having a wrong value for IncomeLossFromContinuingOperation.

    Therefore, we mask the entries, where

    abs(NetIncomeLoss - IncomeLossFromContinuingOperations) = 2*abs(IncomeTaxExpenseBenefit)
    if IncomeTaxExpenseBenefit &gt; 0

    in order to fix the sign for IncomeTaxExpenseBenefit and to correct
    IncomeLossFromContinuingOperations

    The rule also uses some threshold.

    Of course, this is not perfect and does not consider the cases with DiscontinuedOperations,
    However, it is able to fix a significant number of cases.

    For the masked entries, it changes the sign of TaxExpenseBenefit
    and recalculates IncomeLossFromContinuingOperations

    &#34;&#34;&#34;

    def get_target_tags(self) -&gt; List[str]:
        &#34;&#34;&#34;
        returns a list of tags that could be affected/changed by this rule

        Returns:
            List[str]: list with affected tags/columns
        &#34;&#34;&#34;
        return [&#39;IncomeLossFromContinuingOperations&#39;, &#39;AllIncomeTaxExpenseBenefit&#39;]

    def get_input_tags(self) -&gt; Set[str]:
        &#34;&#34;&#34;
        return all tags that the rules within this group need.

        Returns:
            Set[str]: set of all input tags that are used by rules in this group
        &#34;&#34;&#34;
        return {&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
                &#39;AllIncomeTaxExpenseBenefit&#39;, &#39;IncomeLossFromContinuingOperations&#39;, &#39;ProfitLoss&#39;}

    def mask(self, data_df: pd.DataFrame) -&gt; pa.typing.Series[bool]:
        &#34;&#34;&#34;
            returns a Series[bool] which defines the rows to which this rule has to be applied.

        Args:
            data_df dataframe on which the rules should be applied

        Returns:
            pa.typing.Series[bool]: a boolean Series that marks which rows have to be calculated
        &#34;&#34;&#34;
        return (data_df.AllIncomeTaxExpenseBenefit != 0) &amp; \
            ((data_df.ProfitLoss - data_df.IncomeLossFromContinuingOperations).abs() &gt;=
             1.8 * data_df.AllIncomeTaxExpenseBenefit.abs())

    def apply(self, data_df: pd.DataFrame, mask: pa.typing.Series[bool]):
        &#34;&#34;&#34;
        apply the rule on the provided dataframe. the rows, on which the rule has to be applied
        is defined by the provide mask Series.

        Important, the rules have to be applied &#34;in-place&#34;, so no new dataframe is produced.

        Args:
            df: dataframe on which the rule has to be applied
            mask: a Series marking the rows in the dataframe on which the rule has to be applied
        &#34;&#34;&#34;

        data_df.loc[mask, &#39;AllIncomeTaxExpenseBenefit&#39;] = -data_df.AllIncomeTaxExpenseBenefit

        # recalculate IncomeLossFromContinuingOperations
        data_df.loc[mask, &#39;IncomeLossFromContinuingOperations&#39;] = \
            data_df[&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;]
        subtract_mask = mask &amp; ~data_df.AllIncomeTaxExpenseBenefit.isna()
        data_df.loc[subtract_mask, &#39;IncomeLossFromContinuingOperations&#39;] = (
                data_df[&#39;IncomeLossFromContinuingOperations&#39;] -
                data_df.AllIncomeTaxExpenseBenefit)

    def get_description(self) -&gt; str:
        return &#34;Corrects the sign of &#39;IncomeTaxExpenseBenefits&#39; if it seems to be wrong. Checks&#34; \
               &#34;if the difference between &#39;NetIncomeLoss&#39; and &#39;IncomeLossFromContinuingOperations&#39;&#34; \
               &#34;is about 2. Which is a clear indication, that the sign was wrong.&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="secfsdstools.f_standardize.base_rule_framework.Rule" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule">Rule</a></li>
<li><a title="secfsdstools.f_standardize.base_rule_framework.AbstractRule" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.AbstractRule">AbstractRule</a></li>
<li><a title="secfsdstools.f_standardize.base_rule_framework.RuleEntity" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.RuleEntity">RuleEntity</a></li>
<li>abc.ABC</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.identifier"><code class="name">var <span class="ident">identifier</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.apply"><code class="name flex">
<span>def <span class="ident">apply</span></span>(<span>self, data_df: pandas.core.frame.DataFrame, mask: pandera.typing.pandas.Series[bool])</span>
</code></dt>
<dd>
<div class="desc"><p>apply the rule on the provided dataframe. the rows, on which the rule has to be applied
is defined by the provide mask Series.</p>
<p>Important, the rules have to be applied "in-place", so no new dataframe is produced.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>df</code></strong></dt>
<dd>dataframe on which the rule has to be applied</dd>
<dt><strong><code>mask</code></strong></dt>
<dd>a Series marking the rows in the dataframe on which the rule has to be applied</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply(self, data_df: pd.DataFrame, mask: pa.typing.Series[bool]):
    &#34;&#34;&#34;
    apply the rule on the provided dataframe. the rows, on which the rule has to be applied
    is defined by the provide mask Series.

    Important, the rules have to be applied &#34;in-place&#34;, so no new dataframe is produced.

    Args:
        df: dataframe on which the rule has to be applied
        mask: a Series marking the rows in the dataframe on which the rule has to be applied
    &#34;&#34;&#34;

    data_df.loc[mask, &#39;AllIncomeTaxExpenseBenefit&#39;] = -data_df.AllIncomeTaxExpenseBenefit

    # recalculate IncomeLossFromContinuingOperations
    data_df.loc[mask, &#39;IncomeLossFromContinuingOperations&#39;] = \
        data_df[&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;]
    subtract_mask = mask &amp; ~data_df.AllIncomeTaxExpenseBenefit.isna()
    data_df.loc[subtract_mask, &#39;IncomeLossFromContinuingOperations&#39;] = (
            data_df[&#39;IncomeLossFromContinuingOperations&#39;] -
            data_df.AllIncomeTaxExpenseBenefit)</code></pre>
</details>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.get_input_tags"><code class="name flex">
<span>def <span class="ident">get_input_tags</span></span>(<span>self) ‑> Set[str]</span>
</code></dt>
<dd>
<div class="desc"><p>return all tags that the rules within this group need.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>Set[str]</code></dt>
<dd>set of all input tags that are used by rules in this group</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_input_tags(self) -&gt; Set[str]:
    &#34;&#34;&#34;
    return all tags that the rules within this group need.

    Returns:
        Set[str]: set of all input tags that are used by rules in this group
    &#34;&#34;&#34;
    return {&#39;IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit&#39;,
            &#39;AllIncomeTaxExpenseBenefit&#39;, &#39;IncomeLossFromContinuingOperations&#39;, &#39;ProfitLoss&#39;}</code></pre>
</details>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.mask"><code class="name flex">
<span>def <span class="ident">mask</span></span>(<span>self, data_df: pandas.core.frame.DataFrame) ‑> pandera.typing.pandas.Series[bool]</span>
</code></dt>
<dd>
<div class="desc"><p>returns a Series[bool] which defines the rows to which this rule has to be applied.</p>
<h2 id="args">Args</h2>
<p>data_df dataframe on which the rules should be applied</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>pa.typing.Series[bool]</code></dt>
<dd>a boolean Series that marks which rows have to be calculated</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def mask(self, data_df: pd.DataFrame) -&gt; pa.typing.Series[bool]:
    &#34;&#34;&#34;
        returns a Series[bool] which defines the rows to which this rule has to be applied.

    Args:
        data_df dataframe on which the rules should be applied

    Returns:
        pa.typing.Series[bool]: a boolean Series that marks which rows have to be calculated
    &#34;&#34;&#34;
    return (data_df.AllIncomeTaxExpenseBenefit != 0) &amp; \
        ((data_df.ProfitLoss - data_df.IncomeLossFromContinuingOperations).abs() &gt;=
         1.8 * data_df.AllIncomeTaxExpenseBenefit.abs())</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="secfsdstools.f_standardize.base_rule_framework.Rule" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule">Rule</a></b></code>:
<ul class="hlist">
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.collect_description" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.AbstractRule.collect_description">collect_description</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.get_description" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.RuleEntity.get_description">get_description</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags">get_target_tags</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags_str" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags_str">get_target_tags_str</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.process" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule.process">process</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.set_id" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.RuleEntity.set_id">set_id</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixSign"><code class="flex name class">
<span>class <span class="ident">PostFixSign</span></span>
<span>(</span><span>start_tag: str, summand_tag: str, result_tag: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Fixes the sign of an Addition, if the Summand has the wrong sign.</p>
<p>For instance, the following equation should be true:
ProfitLoss + AllIncomeTaxExpenseBenefit = IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit</p>
<p>However, there are cases when
ProfitLoss - AllIncomeTaxExpenseBenefit = IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit</p>
<p>is true, so obviously AllIncomTaxExpenseBenefit has the wrong sign.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class PostFixSign(Rule):
    &#34;&#34;&#34;
    Fixes the sign of an Addition, if the Summand has the wrong sign.

    For instance, the following equation should be true:
    ProfitLoss + AllIncomeTaxExpenseBenefit = IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit

    However, there are cases when
    ProfitLoss - AllIncomeTaxExpenseBenefit = IncomeLossFromContinuingOperationsBeforeIncomeTaxExpenseBenefit

    is true, so obviously AllIncomTaxExpenseBenefit has the wrong sign.

    &#34;&#34;&#34;

    def __init__(self, start_tag: str, summand_tag: str, result_tag: str):
        self.start_tag = start_tag
        self.summand_tag = summand_tag
        self.result_tag = result_tag

    def get_target_tags(self) -&gt; List[str]:
        &#34;&#34;&#34;
        returns a list of tags that could be affected/changed by this rule

        Returns:
            List[str]: list with affected tags/columns
        &#34;&#34;&#34;
        return [self.summand_tag]

    def get_input_tags(self) -&gt; Set[str]:
        &#34;&#34;&#34;
        return all tags that the rules within this group need.

        Returns:
            Set[str]: set of all input tags that are used by rules in this group
        &#34;&#34;&#34;
        return {self.start_tag, self.summand_tag, self.result_tag}

    def mask(self, data_df: pd.DataFrame) -&gt; pa.typing.Series[bool]:
        &#34;&#34;&#34;
            returns a Series[bool] which defines the rows to which this rule has to be applied.

        Args:
            data_df dataframe on which the rules should be applied

        Returns:
            pa.typing.Series[bool]: a boolean Series that marks which rows have to be calculated
        &#34;&#34;&#34;
        return (data_df[self.summand_tag] != 0) &amp; \
            ((data_df[self.start_tag] - data_df[self.summand_tag]) == data_df[self.result_tag])

    def apply(self, data_df: pd.DataFrame, mask: pa.typing.Series[bool]):
        &#34;&#34;&#34;
        apply the rule on the provided dataframe. the rows, on which the rule has to be applied
        is defined by the provide mask Series.

        Important, the rules have to be applied &#34;in-place&#34;, so no new dataframe is produced.

        Args:
            df: dataframe on which the rule has to be applied
            mask: a Series marking the rows in the dataframe on which the rule has to be applied
        &#34;&#34;&#34;
        # simply invert the sign
        data_df.loc[mask, self.summand_tag] = -data_df[self.summand_tag]

    def get_description(self) -&gt; str:
        return f&#34;Corrects the sign of &#39;{self.summand_tag}&#39; if it seems to be wrong.&#34; \
               f&#34;Checks if &#39;{self.start_tag} - {self.summand_tag} = {self.result_tag}&#39;.&#34; \
               f&#34; If that equation holds true, the sign of &#39;{self.summand_tag}&#39; is inversed, &#34; \
               f&#34; so that &#39;{self.start_tag} - {self.summand_tag} = {self.result_tag}&#39; becomes true&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="secfsdstools.f_standardize.base_rule_framework.Rule" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule">Rule</a></li>
<li><a title="secfsdstools.f_standardize.base_rule_framework.AbstractRule" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.AbstractRule">AbstractRule</a></li>
<li><a title="secfsdstools.f_standardize.base_rule_framework.RuleEntity" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.RuleEntity">RuleEntity</a></li>
<li>abc.ABC</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixSign.identifier"><code class="name">var <span class="ident">identifier</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixSign.apply"><code class="name flex">
<span>def <span class="ident">apply</span></span>(<span>self, data_df: pandas.core.frame.DataFrame, mask: pandera.typing.pandas.Series[bool])</span>
</code></dt>
<dd>
<div class="desc"><p>apply the rule on the provided dataframe. the rows, on which the rule has to be applied
is defined by the provide mask Series.</p>
<p>Important, the rules have to be applied "in-place", so no new dataframe is produced.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>df</code></strong></dt>
<dd>dataframe on which the rule has to be applied</dd>
<dt><strong><code>mask</code></strong></dt>
<dd>a Series marking the rows in the dataframe on which the rule has to be applied</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply(self, data_df: pd.DataFrame, mask: pa.typing.Series[bool]):
    &#34;&#34;&#34;
    apply the rule on the provided dataframe. the rows, on which the rule has to be applied
    is defined by the provide mask Series.

    Important, the rules have to be applied &#34;in-place&#34;, so no new dataframe is produced.

    Args:
        df: dataframe on which the rule has to be applied
        mask: a Series marking the rows in the dataframe on which the rule has to be applied
    &#34;&#34;&#34;
    # simply invert the sign
    data_df.loc[mask, self.summand_tag] = -data_df[self.summand_tag]</code></pre>
</details>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixSign.get_input_tags"><code class="name flex">
<span>def <span class="ident">get_input_tags</span></span>(<span>self) ‑> Set[str]</span>
</code></dt>
<dd>
<div class="desc"><p>return all tags that the rules within this group need.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>Set[str]</code></dt>
<dd>set of all input tags that are used by rules in this group</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_input_tags(self) -&gt; Set[str]:
    &#34;&#34;&#34;
    return all tags that the rules within this group need.

    Returns:
        Set[str]: set of all input tags that are used by rules in this group
    &#34;&#34;&#34;
    return {self.start_tag, self.summand_tag, self.result_tag}</code></pre>
</details>
</dd>
<dt id="secfsdstools.f_standardize.is_standardize.PostFixSign.mask"><code class="name flex">
<span>def <span class="ident">mask</span></span>(<span>self, data_df: pandas.core.frame.DataFrame) ‑> pandera.typing.pandas.Series[bool]</span>
</code></dt>
<dd>
<div class="desc"><p>returns a Series[bool] which defines the rows to which this rule has to be applied.</p>
<h2 id="args">Args</h2>
<p>data_df dataframe on which the rules should be applied</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>pa.typing.Series[bool]</code></dt>
<dd>a boolean Series that marks which rows have to be calculated</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def mask(self, data_df: pd.DataFrame) -&gt; pa.typing.Series[bool]:
    &#34;&#34;&#34;
        returns a Series[bool] which defines the rows to which this rule has to be applied.

    Args:
        data_df dataframe on which the rules should be applied

    Returns:
        pa.typing.Series[bool]: a boolean Series that marks which rows have to be calculated
    &#34;&#34;&#34;
    return (data_df[self.summand_tag] != 0) &amp; \
        ((data_df[self.start_tag] - data_df[self.summand_tag]) == data_df[self.result_tag])</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="secfsdstools.f_standardize.base_rule_framework.Rule" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule">Rule</a></b></code>:
<ul class="hlist">
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.collect_description" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.AbstractRule.collect_description">collect_description</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.get_description" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.RuleEntity.get_description">get_description</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags">get_target_tags</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags_str" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule.get_target_tags_str">get_target_tags_str</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.process" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.Rule.process">process</a></code></li>
<li><code><a title="secfsdstools.f_standardize.base_rule_framework.Rule.set_id" href="base_rule_framework.html#secfsdstools.f_standardize.base_rule_framework.RuleEntity.set_id">set_id</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="secfsdstools.f_standardize" href="index.html">secfsdstools.f_standardize</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer">IncomeStatementStandardizer</a></code></h4>
<ul class="">
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.final_tags" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.final_tags">final_tags</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_costofrevenue_rg" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_costofrevenue_rg">is_costofrevenue_rg</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_grossProfit" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_grossProfit">is_grossProfit</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_missing_NTI_PL" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_missing_NTI_PL">is_missing_NTI_PL</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_missing_rev_cost_gross" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_missing_rev_cost_gross">is_missing_rev_cost_gross</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_netincome_rg" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_netincome_rg">is_netincome_rg</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_operating" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_operating">is_operating</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_revenue_rg" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.is_revenue_rg">is_revenue_rg</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.main_rule_tree" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.main_rule_tree">main_rule_tree</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.main_statement_tags" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.main_statement_tags">main_statement_tags</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.post_rule_tree" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.post_rule_tree">post_rule_tree</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.prepivot_rule_tree" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.prepivot_rule_tree">prepivot_rule_tree</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.preprocess_rule_tree" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.preprocess_rule_tree">preprocess_rule_tree</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.validation_rules" href="#secfsdstools.f_standardize.is_standardize.IncomeStatementStandardizer.validation_rules">validation_rules</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit" href="#secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit">PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit</a></code></h4>
<ul class="">
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.apply" href="#secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.apply">apply</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.get_input_tags" href="#secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.get_input_tags">get_input_tags</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.identifier" href="#secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.identifier">identifier</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.mask" href="#secfsdstools.f_standardize.is_standardize.PostFixIncomeLossFromContinuingOperationsAndSignOfIncomeTaxExpenseBenefit.mask">mask</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="secfsdstools.f_standardize.is_standardize.PostFixSign" href="#secfsdstools.f_standardize.is_standardize.PostFixSign">PostFixSign</a></code></h4>
<ul class="">
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixSign.apply" href="#secfsdstools.f_standardize.is_standardize.PostFixSign.apply">apply</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixSign.get_input_tags" href="#secfsdstools.f_standardize.is_standardize.PostFixSign.get_input_tags">get_input_tags</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixSign.identifier" href="#secfsdstools.f_standardize.is_standardize.PostFixSign.identifier">identifier</a></code></li>
<li><code><a title="secfsdstools.f_standardize.is_standardize.PostFixSign.mask" href="#secfsdstools.f_standardize.is_standardize.PostFixSign.mask">mask</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>